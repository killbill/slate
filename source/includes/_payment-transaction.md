# Payment Transaction

Payment transactions belong to a [Payment](payment.html#payment-payment-resource) object.

They represent a particular payment operation, such as authorization, chargeback, refund, etc. Most operations happen at the `Payment` level, but there are a few endpoints
that work directly at the transaction level.

## Payment Transaction Resource

A `PaymentTransaction` is represented by a PaymentTransaction resource object. The attributes for this resource object are as follows:

| Name | Type | Generated by | Description |
| ---- | -----| -------- | ------------ |
| **transactionId** | string | system | UUID for the transaction |
| **transactionExternalKey** | string | user or system | Optional external key |
| **paymentId** | string | system | UUID for the payment |
| **paymentExternalKey** | string | user or system | Optional external key |
| **transactionType** | string | user | Transaction type (see below) |
| **amount** | number | system | Total amount of the transaction |
| **currency** | string | user or system | Currency associated with the account |
| **effectiveDate** | string | user | Effective date of the transaction |
| **processedAmount** | number | system | The amount processed by the gateway (see below) |
| **processedCurrency** | string | system | The currency processed by the gateay (see below) |
| **status** | string | system | Transaction status (see below) |
| **gatewayErrorCode** | string | system | Error code returned by the payment gateway |
| **gatewayErrorMsg** | string | system | Error message returned by the payment gateway |
| **firstPaymentReferenceId** | string | system | Payment gateway reference |
| **secondPaymentReferenceId** | string | system | see below |
| **properties** | string | user | see below |

* **transactionType**: Possible values are: AUTHORIZE, CAPTURE, CHARGEBACK, CREDIT, PURCHASE, REFUND, VOID 

* **processedAmount**: This will often match **amount**, but could be different, perhaps due to currency conversion

* **processedCurrency**: This will often match **currency**, but could be different, perhaps due to currency conversion

* **status**: Possible values are: SUCCESS, UNKNOWN, PENDING, PAYMENT_FAILURE, PLUGIN_FAILURE, or PAYMENT_SYSTEM_OFF

* **secondPaymentReferenceId**: Typically the ID from the actual payment processor, when the gateway is a PSP.

* **properties**: Plugin-specific properties to be interpreted by the plugin


## Payment Transactions

Endpoints to retrieve a `PaymentTransaction` object or to set the status of a pending transaction. Note that endpoints to generate payment transactions are provided with the `Payment` APIs. 



### Retrieve a payment by transaction id

Retrieves a Payment object based on a PaymentTransaction id, which is given as a path parameter


**HTTP Request** 

`GET http://127.0.0.1:8080/1.0/kb/paymentTransactions/{transactionId}`

> Example Request:

```shell
curl -v \
    -u admin:password \
    -H "X-Killbill-ApiKey: bob" \
    -H "X-Killbill-ApiSecret: lazar" \
    -H "Accept: application/json" \
    "http://127.0.0.1:8080/1.0/kb/paymentTransactions/07655b3c-7f17-4172-b193-ece48e5741ad"
```

```java
import org.killbill.billing.client.api.gen.PaymentTransactionApi;
protected PaymentTransactionApi paymentTransactionApi;

UUID paymentTransactionId = UUID.fromString("41f4d299-4371-4876-96b4-0b3cc81b246b");
Map<String, String> NULL_PLUGIN_PROPERTIES = null;
Payment payment = paymentTransactionApi.getPaymentByTransactionId(paymentTransactionId, NULL_PLUGIN_PROPERTIES, requestOptions);
```

```ruby
TODO
```

```python
TODO
```
> Example Response:

```json
{
  "accountId": "2ad52f53-85ae-408a-9879-32a7e59dd03d",
  "paymentId": "e8edd4c6-2f85-4375-95f3-e78ca4d85b82",
  "paymentNumber": "47",
  "paymentExternalKey": "e8edd4c6-2f85-4375-95f3-e78ca4d85b82",
  "authAmount": 0,
  "capturedAmount": 0,
  "purchasedAmount": 0,
  "refundedAmount": 0,
  "creditedAmount": 0,
  "currency": "USD",
  "paymentMethodId": "c02fa9b0-ae95-42ae-9010-bc11cb160947",
  "transactions": [
    {
      "transactionId": "07655b3c-7f17-4172-b193-ece48e5741ad",
      "transactionExternalKey": "07655b3c-7f17-4172-b193-ece48e5741ad",
      "paymentId": "e8edd4c6-2f85-4375-95f3-e78ca4d85b82",
      "paymentExternalKey": "e8edd4c6-2f85-4375-95f3-e78ca4d85b82",
      "transactionType": "AUTHORIZE",
      "amount": 0,
      "currency": "USD",
      "effectiveDate": "2018-07-18T18:58:11.000Z",
      "processedAmount": 0,
      "processedCurrency": "USD",
      "status": "SUCCESS",
      "gatewayErrorCode": null,
      "gatewayErrorMsg": null,
      "firstPaymentReferenceId": null,
      "secondPaymentReferenceId": null,
      "properties": null,
      "auditLogs": []
    }
  ],
  "paymentAttempts": null,
  "auditLogs": []
}
```

**Query Parameters**

| Name | Type | Required | Default | Description |
| ---- | -----| -------- | ------- | ----------- |
| **withPluginInfo** | boolean | no | false | If true, include plugin info |
| **withAttempts** | boolean | no | false | if true, include payment attempts |

**Response**

If successful, returns a status code of 200 and a payment object including the specified transaction.


### Retrieve a payment transaction by external key

Retrieve a Payment object based on a PaymentTransaction external key, which is given as a query parameter


**HTTP Request** 

`GET http://127.0.0.1:8080/1.0/kb/paymentTransactions`

> Example Request:

```shell
curl -v \
    -u admin:password \
    -H "X-Killbill-ApiKey: bob" \
    -H "X-Killbill-ApiSecret: lazar" \
    -H "Accept: application/json" \
    "http://127.0.0.1:8080/1.0/kb/paymentTransactions?transactionExternalKey=07655b3c-7f17-4172-b193-ece48e5741ad"
```

```java
import org.killbill.billing.client.api.gen.PaymentTransactionApi;
protected PaymentTransactionApi paymentTransactionApi;

String transactionExternalKey = "41f4d299-4371-4876-96b4-0b3cc81b246b";
Map<String, String> NULL_PLUGIN_PROPERTIES = null;
Payment payment = paymentTransactionApi.getPaymentByTransactionExternalKey(transactionExternalKey, NULL_PLUGIN_PROPERTIES, requestOptions);

```

```ruby
TODO
```

```python
TODO
```
> Example Response:

```json
{
  "accountId": "2ad52f53-85ae-408a-9879-32a7e59dd03d",
  "paymentId": "e8edd4c6-2f85-4375-95f3-e78ca4d85b82",
  "paymentNumber": "47",
  "paymentExternalKey": "e8edd4c6-2f85-4375-95f3-e78ca4d85b82",
  "authAmount": 0,
  "capturedAmount": 0,
  "purchasedAmount": 0,
  "refundedAmount": 0,
  "creditedAmount": 0,
  "currency": "USD",
  "paymentMethodId": "c02fa9b0-ae95-42ae-9010-bc11cb160947",
  "transactions": [
    {
      "transactionId": "07655b3c-7f17-4172-b193-ece48e5741ad",
      "transactionExternalKey": "07655b3c-7f17-4172-b193-ece48e5741ad",
      "paymentId": "e8edd4c6-2f85-4375-95f3-e78ca4d85b82",
      "paymentExternalKey": "e8edd4c6-2f85-4375-95f3-e78ca4d85b82",
      "transactionType": "AUTHORIZE",
      "amount": 0,
      "currency": "USD",
      "effectiveDate": "2018-07-18T18:58:11.000Z",
      "processedAmount": 0,
      "processedCurrency": "USD",
      "status": "SUCCESS",
      "gatewayErrorCode": null,
      "gatewayErrorMsg": null,
      "firstPaymentReferenceId": null,
      "secondPaymentReferenceId": null,
      "properties": null,
      "auditLogs": []
    }
  ],
  "paymentAttempts": null,
  "auditLogs": []
}
```

**Query Parameters**

| Name | Type | Required | Default | Description |
| ---- | -----| -------- | ------- | ----------- |
| **transactionExternalKey** | string | yes | none | Transaction external key |
| **withPluginInfo** | boolean | no | false | If true, include plugin info |
| **withAttempts** | boolean | no | false | If true, include payment attempts |

**Response**

If successful, returns a status code of 200 and a payment object including the specified transaction.

### Mark a pending payment transaction as succeeded or failed

Sets the status of a PENDING `PaymentTransaction` to SUCCESS or PAYMENT_FAILURE

**HTTP Request** 

`POST http://127.0.0.1:8080/1.0/kb/paymentTransactions/{transactionId}`

> Example Request:

```shell
curl -v \
    -X POST \
    -u admin:password \
    -H "X-Killbill-ApiKey: bob" \
    -H "X-Killbill-ApiSecret: lazar" \
    -H "Content-Type: application/json" \
    -H "Accept: application/json" \
    -H "X-Killbill-CreatedBy: demo" \
    -H "X-Killbill-Reason: demo" \
    -H "X-Killbill-Comment: demo" \
    -d '{"paymentId": "e8edd4c6-2f85-4375-95f3-e78ca4d85b82", "status": "SUCCESS"}' \
    "http://127.0.0.1:8080/1.0/kb/paymentTransactions/07655b3c-7f17-4172-b193-ece48e5741ad"
```

```java
import org.killbill.billing.client.api.gen.PaymentTransactionApi;
protected PaymentTransactionApi paymentTransactionApi;

UUID paymentTransactionId = UUID.fromString("37d15a2f-55ac-40ab-a873-08faae78f213");
PaymentTransaction paymentTransaction = new PaymentTransaction();
paymentTransaction.setStatus(TransactionStatus.SUCCESS);
paymentTransaction.setPaymentId(UUID.fromString("27d15e39-b25c-4dc1-92cf-5487397a48a6");
				
paymentTransactionApi.notifyStateChanged(paymentTransactionId, 
                                         paymentTransaction, 
                                         null, 
                                         requestOptions);
	
```

```ruby
TODO
```

```python
TODO
```

**Request Body**

A `PaymentTransaction` object including, at least, a `paymentId` and a `status` (SUCCESS or PAYMENT_FAILURE)

**Query Parameters**

None.

**Response**

If successful, returns a status code of 201 and the payment object.

## Audit Logs

Audit logs provide a record of events that occur involving various specific resources. For details on audit logs see [Audit and History](https://killbill.github.io/slate/#using-kill-bill-apis-audit-and-history).


### Retrieve payment transaction audit logs with history by id

Retrieves a list of audit log records showing events that occurred involving changes to a specified payment. History information is included with each record.


**HTTP Request** 

`GET http://127.0.0.1:8080/1.0/kb/paymentTransactions/{transactionId}/auditLogsWithHistory`

> Example Request:

```shell
curl -v \
    -u admin:password \
    -H "X-Killbill-ApiKey: bob" \
    -H "X-Killbill-ApiSecret: lazar" \
    -H "Accept: application/json" \
    "http://127.0.0.1:8080/1.0/kb/paymentTransactions/07655b3c-7f17-4172-b193-ece48e5741ad/auditLogsWithHistory"
```

```java
import org.killbill.billing.client.api.gen.PaymentTransactionApi;
protected PaymentTransactionApi paymentTransactionApi;

UUID paymentTransactionId = UUID.fromString("41f4d299-4371-4876-96b4-0b3cc81b246b");

List<AuditLog> result = paymentTransactionApi.getTransactionAuditLogsWithHistory(paymentTransactionId, 
                                                                                 requestOptions);
```

```ruby
TODO
```

```python
TODO
```
> Example Response:

```json
[
  {
    "changeType": "INSERT",
    "changeDate": "2018-07-18T18:58:11.000Z",
    "objectType": "TRANSACTION",
    "objectId": "07655b3c-7f17-4172-b193-ece48e5741ad",
    "changedBy": "demo",
    "reasonCode": "demo",
    "comments": "demo",
    "userToken": "84ac4088-dc76-4fde-9ff0-63e228b5e6fc",
    "history": {
      "id": null,
      "createdDate": "2018-07-18T18:58:11.000Z",
      "updatedDate": "2018-07-18T18:58:11.000Z",
      "recordId": 63,
      "accountRecordId": 120,
      "tenantRecordId": 101,
      "attemptId": null,
      "paymentId": "e8edd4c6-2f85-4375-95f3-e78ca4d85b82",
      "transactionExternalKey": "07655b3c-7f17-4172-b193-ece48e5741ad",
      "transactionType": "AUTHORIZE",
      "effectiveDate": "2018-07-18T18:58:11.000Z",
      "transactionStatus": "UNKNOWN",
      "amount": 0,
      "currency": "USD",
      "processedAmount": null,
      "processedCurrency": null,
      "gatewayErrorCode": null,
      "gatewayErrorMsg": null,
      "tableName": "PAYMENT_TRANSACTIONS",
      "historyTableName": "PAYMENT_TRANSACTION_HISTORY"
    }
  },
  {
    "changeType": "UPDATE",
    "changeDate": "2018-07-18T18:58:11.000Z",
    "objectType": "TRANSACTION",
    "objectId": "07655b3c-7f17-4172-b193-ece48e5741ad",
    "changedBy": "demo",
    "reasonCode": "demo",
    "comments": "demo",
    "userToken": "84ac4088-dc76-4fde-9ff0-63e228b5e6fc",
    "history": {
      "id": null,
      "createdDate": "2018-07-18T18:58:11.000Z",
      "updatedDate": "2018-07-18T18:58:11.000Z",
      "recordId": 63,
      "accountRecordId": 120,
      "tenantRecordId": 101,
      "attemptId": null,
      "paymentId": "e8edd4c6-2f85-4375-95f3-e78ca4d85b82",
      "transactionExternalKey": "07655b3c-7f17-4172-b193-ece48e5741ad",
      "transactionType": "AUTHORIZE",
      "effectiveDate": "2018-07-18T18:58:11.000Z",
      "transactionStatus": "SUCCESS",
      "amount": 0,
      "currency": "USD",
      "processedAmount": 0,
      "processedCurrency": "USD",
      "gatewayErrorCode": null,
      "gatewayErrorMsg": null,
      "tableName": "PAYMENT_TRANSACTIONS",
      "historyTableName": "PAYMENT_TRANSACTION_HISTORY"
    }
  }
]
```

**Query Parameters**

None.

**Response**
    
If successful, returns a status code of 200 and a list of account audit logs with history.

## Custom Fields

Custom fields are `{key, value}` attributes that can be attached to any customer resource. In particular they can be added to `PaymentTransaction` objects. For details on Custom Fields see [Custom Field](custom-field.html).

### Add custom fields to payment transaction

Adds one or more custom fields to a `PaymentTransaction` object. Existing custom fields are not modified.


**HTTP Request** 

`POST http://127.0.0.1:8080/1.0/kb/paymentTransactions/{transactionId}/customFields`

> Example Request:

```shell
curl -v \
    -X POST \
    -u admin:password \
    -H 'X-Killbill-ApiKey: bob' \
    -H 'X-Killbill-ApiSecret: lazar' \
    -H 'Content-Type: application/json' \
    -H 'X-Killbill-CreatedBy: demo' \
    -d '[{ 
            "name": "Test Custom Field",
            "value": "test_value"
    }]' \
    'http://127.0.0.1:8080/1.0/kb/paymentTransactions/8fe697d4-2c25-482c-aa45-f6cd5a48186d/customFields' 
```

```java
import org.killbill.billing.client.api.gen.PaymentTransactionApi;
protected PaymentTransactionApi paymentTransactionApi;

UUID paymentTransactionId = UUID.fromString("cca08349-8b26-41c7-bfcc-2e3cf70a0f28");

final List<AuditLog> EMPTY_AUDIT_LOGS = Collections.emptyList();

CustomFields customFields = new CustomFields();
customFields.add(new CustomField(null, 
                                 paymentTransactionId, 
                                 ObjectType.TRANSACTION, 
                                 "Test Custom Field", 
                                 "test_value", 
                                 EMPTY_AUDIT_LOGS));

paymentTransactionApi.createTransactionCustomFields(paymentTransactionId, 
                                                    customFields, 
                                                    requestOptions);
```

```ruby
TODO
```

```python
paymentTransactionApi = killbill.api.PaymentTransactionApi()
body = CustomField(name='Test Custom Field', value='test_value')

paymentTransactionApi.create_transaction_custom_fields(payment_transaction_id,
                                                       [body],
                                                       created_by,
                                                       api_key,
                                                       api_secret)
```

**Request Body**

A JSON string representing the custom field object or objects to be added. For example:

[ { "name": "CF1", "value": "123" } ]

**Query Parameters**

None.

**Response**

If successful, returns a 201 status code. In addition, a `Location` header is returned giving the URL to retrieve the custom fields associated with the payment transaction.

### Retrieve payment transaction custom fields 

Retrieves the custom fields associated with a payment transaction

**HTTP Request** 

`GET http://127.0.0.1:8080/1.0/kb/paymentTransactions/{transactionId}/customFields`

> Example Request:

```shell
curl \
    -u admin:password \
    -H 'X-Killbill-ApiKey: bob' \
    -H 'X-Killbill-ApiSecret: lazar' \
    -H 'Accept: application/json' \
    'http://127.0.0.1:8080/1.0/kb/paymentTransactions/8fe697d4-2c25-482c-aa45-f6cd5a48186d/customFields' 
```

```java
import org.killbill.billing.client.api.gen.PaymentTransactionApi;
protected PaymentTransactionApi paymentTransactionApi;

UUID paymentTransactionId = UUID.fromString("cca08349-8b26-41c7-bfcc-2e3cf70a0f28");

List<CustomField> customFields = paymentTransactionApi.getTransactionCustomFields(paymentTransactionId,
                                                                                  AuditLevel.NONE,
                                                                                  requestOptions);
```

```ruby
TODO
```

```python
paymentTransactionApi = killbill.api.PaymentTransactionApi()

paymentTransactionApi.get_transaction_custom_fields(payment_transaction_id, api_key, api_secret)
```

> Example Response:

```json
[
  {
    "customFieldId": "e4bac228-872d-4966-8072-2c3ac06442ed",
    "objectId": "8fe697d4-2c25-482c-aa45-f6cd5a48186d",
    "objectType": "TRANSACTION",
    "name": "Test Custom Field",
    "value": "test_value",
    "auditLogs": []
  }
]
```

**Query Parameters**

| Name | Type | Required | Default | Description |
| ---- | -----| -------- | ------- | ----------- | 
| **audit** | string | no | "NONE" | Level of audit information to return |

Audit information options are "NONE", "MINIMAL" (only inserts), or "FULL".

**Response**
    
If successful, returns a status code of 200 and a list of custom field objects

### Modify custom fields for a payment transaction

Modifies the custom fields associated with a `PaymentTransaction` object


**HTTP Request** 

`PUT http://127.0.0.1:8080/1.0/kb/paymentTransactions/{transactionId}/customFields`

> Example Request:

```shell
curl -v \
    -X PUT \
    -u admin:password \
    -H 'X-Killbill-ApiKey: bob' \
    -H 'X-Killbill-ApiSecret: lazar' \
    -H 'Content-Type: application/json' \
    -H 'X-Killbill-CreatedBy: demo' \
    -d '[{ 
            "customFieldId": "e4bac228-872d-4966-8072-2c3ac06442ed",
            "value": "NewValue"
    }]' \
    'http://127.0.0.1:8080/1.0/kb/paymentTransactions/8fe697d4-2c25-482c-aa45-f6cd5a48186d/customFields' 
```

```java
import org.killbill.billing.client.api.gen.PaymentTransactionApi;
protected PaymentTransactionApi paymentTransactionApi;

UUID paymentTransactionId = UUID.fromString("cca08349-8b26-41c7-bfcc-2e3cf70a0f28");
UUID customFieldsId = UUID.fromString("9913e0f6-b5ef-498b-ac47-60e1626eba8f");

CustomField customFieldModified = new CustomField();
customFieldModified.setCustomFieldId(customFieldsId);
customFieldModified.setValue("NewValue");
CustomFields customFields = new CustomFields();
customFields.add(customFieldModified);
paymentTransactionApi.modifyTransactionCustomFields(paymentTransactionId, 
                                                    customFields, 
                                                    requestOptions);
```

```ruby
TODO
```
```python
paymentTransactionApi = killbill.api.PaymentTransactionApi()

custom_field_id = '9913e0f6-b5ef-498b-ac47-60e1626eba8f'
body = CustomField(custom_field_id=custom_field_id, name='Test Modify', value='test_modify_value')

paymentTransactionApi.modify_transaction_custom_fields(payment_transaction_id,
                                                       [body],
                                                       created_by,
                                                       api_key,
                                                       api_secret)
```

**Requst Body**

A JSON string representing a list of custom fields to substitute for the existing ones.
For example:

[ { "customFieldId": "6d4c073b-fd89-4e39-9802-eba65f42492f", "value": "123" } ]

Although the field name and object type can be specified in the request body, these cannot be modified, only the field value can be modified.


**Query Parameters**

None.

**Response**

If successful, returns a status code of 204 and an empty body.


### Remove custom fields from a payment transaction

Removes a specified set of custom fields from a payment transaction object

**HTTP Request** 

`DELETE http://127.0.0.1:8080/1.0/kb/paymentTransactions/{transactionId}/customFields`

> Example Request:

```shell
curl -v \
    -X DELETE \
    -u admin:password \
    -H 'X-Killbill-ApiKey: bob' \
    -H 'X-Killbill-ApiSecret: lazar' \
    -H 'X-Killbill-CreatedBy: demo' \
    'http://127.0.0.1:8080/1.0/kb/paymentTransactions/77e23878-8b9d-403b-bf31-93003e125712/customFields?customField=e4bac228-872d-4966-8072-2c3ac06442ed' 
```

```java
import org.killbill.billing.client.api.gen.PaymentTransactionApi;
protected PaymentTransactionApi paymentTransactionApi;

UUID paymentTransactionId = UUID.fromString("cca08349-8b26-41c7-bfcc-2e3cf70a0f28");
UUID customFieldsId = UUID.fromString("9913e0f6-b5ef-498b-ac47-60e1626eba8f");
List<UUID> customFieldsList = List.of(customFieldsId);
paymentTransactionApi.deleteTransactionCustomFields(paymentTransactionId, 
                                                    customFieldsList, 
                                                    requestOptions);
```

```ruby
TODO
```

```python
paymentTransactionApi = killbill.api.PaymentTransactionApi()

payment_transaction_id = 'f33e0adc-78df-438a-b920-aaacd7f8597a'

paymentTransactionApi.delete_transaction_custom_fields(payment_transaction_id,
                                                       created_by,
                                                       api_key,
                                                       api_secret)
```

**Query Parameters**

| Name | Type | Required | Default | Description |
| ---- | -----| -------- | ------- | ----------- | 
| **customField** | string | yes | none | Comma separated list of custom field object IDs that should be deleted. |

**Response**

If successful, returns a status code of 204 and an empty body.


## Tags

See [Account Tags](account.html#account-tags) for an introduction.

The are no `system` tags applicable to a Payment Transaction.

### Add tags to a payment transaction

Adds one or more tags to a `PaymentTransaction` object. The tag definitions must already exist.


**HTTP Request** 

`POST http://127.0.0.1:8080/1.0/kb/paymentTransactions/{transactionId}/tags`

> Example Request:

```shell
curl -v \
    -X POST \
    -u admin:password \
    -H 'X-Killbill-ApiKey: bob' \
    -H 'X-Killbill-ApiSecret: lazar' \
    -H 'Content-Type: application/json' \
    -H 'X-Killbill-CreatedBy: demo' \
    -d '[
            "353752dd-9041-4450-b782-a8bb03a923c8"
        ]' \
    'http://127.0.0.1:8080/1.0/kb/paymentTransactions/8fe697d4-2c25-482c-aa45-f6cd5a48186d/tags' 
```

```java
import org.killbill.billing.client.api.gen.PaymentTransactionApi;
protected PaymentTransactionApi paymentTransactionApi;

UUID paymentTransactionId = UUID.fromString("917992d3-5f1f-4828-9fff-799cc4211aa9");

UUID tagDefinitionId = UUID.fromString("353752dd-9041-4450-b782-a8bb03a923c8");

Tags result = paymentTransactionApi.createTransactionTags(paymentTransactionId, 
                                                          List.of(tagDefinitionId), 
                                                          requestOptions);
```

```ruby
TODO
```

```python
paymentTransactionApi = killbill.api.PaymentTransactionApi()

tag = ["353752dd-9041-4450-b782-a8bb03a923c8"]

paymentTransactionApi.create_transaction_tags(payment_transaction_id,
                                              tag,
                                              created_by,
                                              api_key,
                                              api_secret)
```

**Request Body**

Provides a list of tag definition Ids in JSON format

**Query Parameters**

None.

**Response**

If successful, returns a 201 status code. In addition, a `Location` header is returned giving the URL to retrieve the tags associated with the payment transaction.

### Retrieve payment transaction tags

Retrieves all tags attached to this payment transaction.


**HTTP Request** 

`GET http://127.0.0.1:8080/1.0/kb/paymentTransactions/{transactionId}/tags`

> Example Request:

```shell
curl \
    -u admin:password \
    -H 'X-Killbill-ApiKey: bob' \
    -H 'X-Killbill-ApiSecret: lazar' \
    -H 'Accept: application/json' \
    'http://127.0.0.1:8080/1.0/kb/paymentTransactions/8fe697d4-2c25-482c-aa45-f6cd5a48186d/tags' 
```

```java
import org.killbill.billing.client.api.gen.PaymentTransactionApi;
protected PaymentTransactionApi paymentTransactionApi;

UUID paymentTransactionId = UUID.fromString("e659f0f3-745c-46d5-953c-28fe9282fc7d");

Boolean includedDeleted = false; // Will not include deleted tags

List<Tag> tags = paymentTransactionApi.getTransactionTags(paymentTransactionId, 
                                                          includedDeleted, 
                                                          AuditLevel.FULL, 
                                                          requestOptions);
```

```ruby
TODO
```

```python
paymentTransactionApi = killbill.api.PaymentTransactionApi()

payment_transaction_id = '28af3cb9-275b-4ac4-a55d-a0536e479069'

paymentTransactionApi.get_transaction_tags(payment_transaction_id, api_key, api_secret)
```

> Example Response:

```json
[
  {
    "tagId": "890e3b13-3114-478b-9365-50f1a2682143",
    "objectType": "TRANSACTION",
    "objectId": "8fe697d4-2c25-482c-aa45-f6cd5a48186d",
    "tagDefinitionId": "353752dd-9041-4450-b782-a8bb03a923c8",
    "tagDefinitionName": "foo",
    "auditLogs": []
  }
]
```

**Query Parameters**

| Name | Type | Required | Default | Description |
| ---- | -----| -------- | ------- | ------------ |
| **includedDeleted** | boolean | no | false | If true, include deleted tags |
| **audit** | string | no | "NONE" | Level of audit information to return |

Audit information options are "NONE", "MINIMAL" (only inserts), or "FULL".

**Response**
    
If successful, returns a status code of 200 and a list of tag objects.

### Remove tags from a payment transaction

Removes a list of tags attached to a payment transaction.

**HTTP Request** 

`DELETE http://127.0.0.1:8080/1.0/kb/paymentTransactions/{transactionId}/tags`

> Example Request:

```shell
curl -v \
    -X DELETE \
    -u admin:password \
    -H 'X-Killbill-ApiKey: bob' \
    -H 'X-Killbill-ApiSecret: lazar' \
    -H 'X-Killbill-CreatedBy: demo' \
    'http://127.0.0.1:8080/1.0/kb/paymentTransactions/8fe697d4-2c25-482c-aa45-f6cd5a48186d/tags?tagDef=353752dd-9041-4450-b782-a8bb03a923c8' 	
```

```java
import org.killbill.billing.client.api.gen.PaymentTransactionApi;
protected PaymentTransactionApi paymentTransactionApi;

UUID paymentTransactionId = UUID.fromString("e659f0f3-745c-46d5-953c-28fe9282fc7d");

UUID tagDefinitionId = UUID.fromString("353752dd-9041-4450-b782-a8bb03a923c8");

paymentTransactionApi.deleteTransactionTags(paymentTransactionId, 
                                            List.of(tagDefinitionId), 
                                            requestOptions);
```

```ruby
TODO
```

```python
paymentTransactionApi = killbill.api.PaymentTransactionApi()

payment_transaction_id = 'dce5b2a0-0f0f-430b-9427-545ba4be5c7f'
tag = ["353752dd-9041-4450-b782-a8bb03a923c8"] 

paymentTransactionApi.delete_transaction_tags(payment_transaction_id,
                                              created_by,
                                              api_key,
                                              api_secret,
                                              tag_def=tag)
```

**Query Parameters**

| Name | Type | Required | Default | Description |
| ---- | -----| -------- | ------- | ------------ |
| **tagDef** | array of string | yes | none | List of tag definition IDs identifying the tags that should be removed. |

**Response**

If successful, returns a status code of 204 and an empty body.
